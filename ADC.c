/********************************************************/
/* Author: Nicolás Díez Risueño							*/
/* Date: November 2014									*/
/* File: ADC.c											*/
/********************************************************/
#include "ADC.h"
#include <math.h>
#include "msp430f5638.h"
#include "stdlib.h"
#include "HAL.h"
#include "Acciones2.h"

#ifdef __RTOS_ENABLED
	#include <ti/sysbios/BIOS.h>
	#include <ti/sysbios/knl/Task.h>
	#include <ti/sysbios/knl/Event.h>
	#include <xdc/runtime/Error.h>
	#include <xdc/std.h>
	#include <xdc/runtime/System.h>
	#include <xdc/cfg/global.h>
	#include <xdc/runtime/Memory.h>
	#include <xdc/runtime/Types.h>
	#include <ti/sysbios/hal/Timer.h>
	#include <ti/sysbios/knl/Queue.h>
	#include <ti/sysbios/knl/Semaphore.h>
	#include <ti/sysbios/knl/Clock.h>
	#include <ti/sysbios/hal/Hwi.h>
#endif

//---------------------------------------- VARIABLE DECLARATIONS ----------------------------------------
//To store ADC read values for Incident and Reflected Power on bands Low Freq, High Frew and Incident PrePower on LF and HF
unsigned long Power_FWD_LF = 0;
unsigned long Power_RVS_LF = 0;
unsigned long Power_FWD_HF = 0;
unsigned long Power_RVS_HF = 0;
unsigned long PrePower_FWD_LF = 0;
unsigned long PrePower_FWD_HF = 0;

//To store ADC read values for Temperature LF & HF
unsigned long TempeSum_LF = 0;						//Sum for average
unsigned long TempeSum_HF = 0;
unsigned long TempeAvg_LF = 0;						//Average value
unsigned long TempeAvg_HF = 0;

//Power average (todo: Crear variables para almacenar el valor del AVG, ahora se re-usan las Sum)
unsigned long PowerSum_FWD_LF = 0;
unsigned long PowerSum_RVS_LF = 0;
unsigned long PowerSum_FWD_HF = 0;
unsigned long PowerSum_RVS_HF = 0;
unsigned long PrePowerSum_FWD_LF = 0;
unsigned long PrePowerSum_FWD_HF = 0;

unsigned long PowerAvg_FWD_LF = 0;
unsigned long PowerAvg_RVS_LF = 0;
unsigned long PowerAvg_FWD_HF = 0;
unsigned long PowerAvg_RVS_HF = 0;
unsigned long PrePowerAvg_FWD_LF = 0;
unsigned long PrePowerAvg_FWD_HF = 0;

//todo: PREGUNTAR!! Los vectores para el LF y HF del Platinum
//Longitud 2101 elementos
const unsigned long POT_900[] = {207014135,205116218,203235701,201372425,199526231,197696964,195884467,194088588,192309173,190546072,188799135,187068214,185353162,183653834,181970086,180301774,178648757,177010896,175388050,173780083,172186857,170608239,169044093,167494288,165958691,164437172,162929603,161435856,159955803,158489319,157036280,155596563,154170045,152756606,151356125,149968484,148593564,147231250,145881426,144543977,143218790,141905752,140604752,139315680,138038426,136772883,135518941,134276496,133045442,131825674,130617089,129419584,128233058,127057411,125892541,124738351,123594743,122461620,121338885,120226443,119124201,118032064,116949939,115877736,114815362,113762729,112719746,111686325,110662378,109647820,108642562,107646521,106659612,105681751,104712855,103752842,102801630,101859139,100925289,100000000,99083194,98174794,97274722,96382902,95499259,94623716,93756201,92896639,92044957,91201084,90364947,89536477,88715601,87902252,87096359,86297855,85506671,84722741,83945999,83176377,82413812,81658237,80909590,80167806,79432823,78704579,77983011,77268059,76559661,75857758,75162289,74473197,73790423,73113908,72443596,71779429,71121351,70469307,69823240,69183097,68548823,67920363,67297666,66680677,66069345,65463617,64863443,64268772,63679552,63095734,62517269,61944108,61376201,60813500,60255959,59703529,59156163,58613816,58076442,57543994,57016427,56493697,55975760,55462571,54954087,54450265,53951062,53456436,52966344,52480746,51999600,51522864,51050500,50582466,50118723,49659232,49203954,48752849,48305880,47863009,47424199,46989411,46558609,46131757,45708819,45289758,44874539,44463127,44055486,43651583,43251383,42854852,42461956,42072663,41686938,41304750,40926066,40550854,40179081,39810717,39445730,39084090,38725764,38370725,38018940,37670380,37325016,36982818,36643757,36307805,35974934,35645113,35318317,34994517,34673685,34355795,34040819,33728731,33419504,33113112,32809529,32508730,32210688,31915379,31622777,31332857,31045596,30760968,30478950,30199517,29922646,29648314,29376497,29107171,28840315,28575905,28313920,28054336,27797133,27542287,27289778,27039584,26791683,26546056,26302680,26061535,25822602,25585859,25351286,25118864,24888573,24660393,24434306,24210290,23988329,23768403,23550493,23334581,23120648,22908677,22698649,22490546,22284351,22080047,21877616,21677041,21478305,21281390,21086281,20892961,20701413,20511622,20323570,20137242,19952623,19769696,19588447,19408859,19230917,19054607,18879913,18706821,18535316,18365383,18197009,18030177,17864876,17701090,17538805,17378008,17218686,17060824,16904409,16749429,16595869,16443717,16292960,16143586,15995580,15848932,15703628,15559656,15417005,15275661,15135612,14996848,14859356,14723125,14588143,14454398,14321879,14190575,14060475,13931568,13803843,13677288,13551894,13427650,13304544,13182567,13061709,12941958,12823306,12705741,12589254,12473835,12359474,12246162,12133889,12022644,11912420,11803206,11694994,11587774,11481536,11376273,11271975,11168632,11066238,10964782,10864256,10764652,10665961,10568175,10471285,10375284,10280163,10185914,10092529,10000000,9908319,9817479,9727472,9638290,9549926,9462372,9375620,9289664,9204496,9120108,9036495,8953648,8871560,8790225,8709636,8629785,8550667,8472274,8394600,8317638,8241381,8165824,8090959,8016781,7943282,7870458,7798301,7726806,7655966,7585776,7516229,7447320,7379042,7311391,7244360,7177943,7112135,7046931,6982324,6918310,6854882,6792036,6729767,6668068,6606934,6546362,6486344,6426877,6367955,6309573,6251727,6194411,6137620,6081350,6025596,5970353,5915616,5861382,5807644,5754399,5701643,5649370,5597576,5546257,5495409,5445027,5395106,5345644,5296634,5248075,5199960,5152286,5105050,5058247,5011872,4965923,4920395,4875285,4830588,4786301,4742420,4698941,4655861,4613176,4570882,4528976,4487454,4446313,4405549,4365158,4325138,4285485,4246196,4207266,4168694,4130475,4092607,4055085,4017908,3981072,3944573,3908409,3872576,3837072,3801894,3767038,3732502,3698282,3664376,3630781,3597493,3564511,3531832,3499452,3467369,3435579,3404082,3372873,3341950,3311311,3280953,3250873,3221069,3191538,3162278,3133286,3104560,3076097,3047895,3019952,2992265,2964831,2937650,2910717,2884032,2857591,2831392,2805434,2779713,2754229,2728978,2703958,2679168,2654606,2630268,2606154,2582260,2558586,2535129,2511886,2488857,2466039,2443431,2421029,2398833,2376840,2355049,2333458,2312065,2290868,2269865,2249055,2228435,2208005,2187762,2167704,2147830,2128139,2108628,2089296,2070141,2051162,2032357,2013724,1995262,1976970,1958845,1940886,1923092,1905461,1887991,1870682,1853532,1836538,1819701,1803018,1786488,1770109,1753881,1737801,1721869,1706082,1690441,1674943,1659587,1644372,1629296,1614359,1599558,1584893,1570363,1555966,1541700,1527566,1513561,1499685,1485936,1472313,1458814,1445440,1432188,1419058,1406048,1393157,1380384,1367729,1355189,1342765,1330454,1318257,1306171,1294196,1282331,1270574,1258925,1247384,1235947,1224616,1213389,1202264,1191242,1180321,1169499,1158777,1148154,1137627,1127197,1116863,1106624,1096478,1086426,1076465,1066596,1056818,1047129,1037528,1028016,1018591,1009253,1000000,990832,981748,972747,963829,954993,946237,937562,928966,920450,912011,903649,895365,887156,879023,870964,862979,855067,847227,839460,831764,824138,816582,809096,801678,794328,787046,779830,772681,765597,758578,751623,744732,737904,731139,724436,717794,711214,704693,698232,691831,685488,679204,672977,666807,660693,654636,648634,642688,636796,630957,625173,619441,613762,608135,602560,597035,591562,586138,580764,575440,570164,564937,559758,554626,549541,544503,539511,534564,529663,524807,519996,515229,510505,505825,501187,496592,492040,487528,483059,478630,474242,469894,465586,461318,457088,452898,448745,444631,440555,436516,432514,428549,424620,420727,416869,413048,409261,405509,401791,398107,394457,390841,387258,383707,380189,376704,373250,369828,366438,363078,359749,356451,353183,349945,346737,343558,340408,337287,334195,331131,328095,325087,322107,319154,316228,313329,310456,307610,304789,301995,299226,296483,293765,291072,288403,285759,283139,280543,277971,275423,272898,270396,267917,265461,263027,260615,258226,255859,253513,251189,248886,246604,244343,242103,239883,237684,235505,233346,231206,229087,226986,224905,222844,220800,218776,216770,214783,212814,210863,208930,207014,205116,203236,201372,199526,197697,195884,194089,192309,190546,188799,187068,185353,183654,181970,180302,178649,177011,175388,173780,172187,170608,169044,167494,165959,164437,162930,161436,159956,158489,157036,155597,154170,152757,151356,149968,148594,147231,145881,144544,143219,141906,140605,139316,138038,136773,135519,134276,133045,131826,130617,129420,128233,127057,125893,124738,123595,122462,121339,120226,119124,118032,116950,115878,114815,113763,112720,111686,110662,109648,108643,107647,106660,105682,104713,103753,102802,101859,100925,100000,99083,98175,97275,96383,95499,94624,93756,92897,92045,91201,90365,89536,88716,87902,87096,86298,85507,84723,83946,83176,82414,81658,80910,80168,79433,78705,77983,77268,76560,75858,75162,74473,73790,73114,72444,71779,71121,70469,69823,69183,68549,67920,67298,66681,66069,65464,64863,64269,63680,63096,62517,61944,61376,60814,60256,59704,59156,58614,58076,57544,57016,56494,55976,55463,54954,54450,53951,53456,52966,52481,52000,51523,51050,50582,50119,49659,49204,48753,48306,47863,47424,46989,46559,46132,45709,45290,44875,44463,44055,43652,43251,42855,42462,42073,41687,41305,40926,40551,40179,39811,39446,39084,38726,38371,38019,37670,37325,36983,36644,36308,35975,35645,35318,34995,34674,34356,34041,33729,33420,33113,32810,32509,32211,31915,31623,31333,31046,30761,30479,30200,29923,29648,29376,29107,28840,28576,28314,28054,27797,27542,27290,27040,26792,26546,26303,26062,25823,25586,25351,25119,24889,24660,24434,24210,23988,23768,23550,23335,23121,22909,22699,22491,22284,22080,21878,21677,21478,21281,21086,20893,20701,20512,20324,20137,19953,19770,19588,19409,19231,19055,18880,18707,18535,18365,18197,18030,17865,17701,17539,17378,17219,17061,16904,16749,16596,16444,16293,16144,15996,15849,15704,15560,15417,15276,15136,14997,14859,14723,14588,14454,14322,14191,14060,13932,13804,13677,13552,13428,13305,13183,13062,12942,12823,12706,12589,12474,12359,12246,12134,12023,11912,11803,11695,11588,11482,11376,11272,11169,11066,10965,10864,10765,10666,10568,10471,10375,10280,10186,10093,10000,9908,9817,9727,9638,9550,9462,9376,9290,9204,9120,9036,8954,8872,8790,8710,8630,8551,8472,8395,8318,8241,8166,8091,8017,7943,7870,7798,7727,7656,7586,7516,7447,7379,7311,7244,7178,7112,7047,6982,6918,6855,6792,6730,6668,6607,6546,6486,6427,6368,6310,6252,6194,6138,6081,6026,5970,5916,5861,5808,5754,5702,5649,5598,5546,5495,5445,5395,5346,5297,5248,5200,5152,5105,5058,5012,4966,4920,4875,4831,4786,4742,4699,4656,4613,4571,4529,4487,4446,4406,4365,4325,4285,4246,4207,4169,4130,4093,4055,4018,3981,3945,3908,3873,3837,3802,3767,3733,3698,3664,3631,3597,3565,3532,3499,3467,3436,3404,3373,3342,3311,3281,3251,3221,3192,3162,3133,3105,3076,3048,3020,2992,2965,2938,2911,2884,2858,2831,2805,2780,2754,2729,2704,2679,2655,2630,2606,2582,2559,2535,2512,2489,2466,2443,2421,2399,2377,2355,2333,2312,2291,2270,2249,2228,2208,2188,2168,2148,2128,2109,2089,2070,2051,2032,2014,1995,1977,1959,1941,1923,1905,1888,1871,1854,1837,1820,1803,1786,1770,1754,1738,1722,1706,1690,1675,1660,1644,1629,1614,1600,1585,1570,1556,1542,1528,1514,1500,1486,1472,1459,1445,1432,1419,1406,1393,1380,1368,1355,1343,1330,1318,1306,1294,1282,1271,1259,1247,1236,1225,1213,1202,1191,1180,1169,1159,1148,1138,1127,1117,1107,1096,1086,1076,1067,1057,1047,1038,1028,1019,1009,1000,991,982,973,964,955,946,938,929,920,912,904,895,887,879,871,863,855,847,839,832,824,817,809,802,794,787,780,773,766,759,752,745,738,731,724,718,711,705,698,692,685,679,673,667,661,655,649,643,637,631,625,619,614,608,603,597,592,586,581,575,570,565,560,555,550,545,540,535,530,525,520,515,511,506,501,497,492,488,483,479,474,470,466,461,457,453,449,445,441,437,433,429,425,421,417,413,409,406,402,398,394,391,387,384,380,377,373,370,366,363,360,356,353,350,347,344,340,337,334,331,328,325,322,319,316,313,310,308,305,302,299,296,294,291,288,286,283,281,278,275,273,270,268,265,263,261,258,256,254,251,249,247,244,242,240,238,236,233,231,229,227,225,223,221,219,217,215,213,211,209,207,205,203,201,200,198,196,194,192,191,189,187,185,184,182,180,179,177,175,174,172,171,169,167,166,164,163,161,160,158,157,156,154,153,151,150,149,147,146,145,143,142,141,139,138,137,136,134,133,132,131,129,128,127,126,125,124,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,95,94,93,92,91,90,90,89,88,87,86,86,85,84,83,82,82,81,80,79,79,78,77,77,76,75,74,74,73,72,72,71,70,70,69,69,68,67,67,66,65,65,64,64,63,63,62,61,61,60,60,59,59,58,58,57,56,56,55,55,54,54,53,53,52,52,52,51,51,50,50,49,49,48,48,47,47,47,46,46,45,45,44,44,44,43,43,42,42,42,41,41,41,40,40,39,39,39,38,38,38,37,37,37,36,36,36,35,35,35,34,34,34,33,33,33,33,32,32,32,31,31,31,30,30,30,30,29,29,29,29,28,28,28,28,27,27,27,27,26,26,26,26,25,25,25,25,24,24,24,24,24,23,23,23,23,22,22,22,22,22,21,21,21,21,21,21,20,20,20,20,20,19,19,19,19,19,19,18,18,18,18,18,18,17,17,17,17,17,17,16,16,16,16,16,16,16,15,15,15,15,15,15,15,14,14,14,14,14,14,14,14,13,13,13,13,13,13,13,13,12,12,12,12,12,12,12,12,12,11,11,11,11,11,11,11,11,11,11,10,10,10,10,10,10,10,10,10,10,10,9,9,9,9,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0};
const unsigned long POT_1800[] = {207014135,205116218,203235701,201372425,199526231,197696964,195884467,194088588,192309173,190546072,188799135,187068214,185353162,183653834,181970086,180301774,178648757,177010896,175388050,173780083,172186857,170608239,169044093,167494288,165958691,164437172,162929603,161435856,159955803,158489319,157036280,155596563,154170045,152756606,151356125,149968484,148593564,147231250,145881426,144543977,143218790,141905752,140604752,139315680,138038426,136772883,135518941,134276496,133045442,131825674,130617089,129419584,128233058,127057411,125892541,124738351,123594743,122461620,121338885,120226443,119124201,118032064,116949939,115877736,114815362,113762729,112719746,111686325,110662378,109647820,108642562,107646521,106659612,105681751,104712855,103752842,102801630,101859139,100925289,100000000,99083194,98174794,97274722,96382902,95499259,94623716,93756201,92896639,92044957,91201084,90364947,89536477,88715601,87902252,87096359,86297855,85506671,84722741,83945999,83176377,82413812,81658237,80909590,80167806,79432823,78704579,77983011,77268059,76559661,75857758,75162289,74473197,73790423,73113908,72443596,71779429,71121351,70469307,69823240,69183097,68548823,67920363,67297666,66680677,66069345,65463617,64863443,64268772,63679552,63095734,62517269,61944108,61376201,60813500,60255959,59703529,59156163,58613816,58076442,57543994,57016427,56493697,55975760,55462571,54954087,54450265,53951062,53456436,52966344,52480746,51999600,51522864,51050500,50582466,50118723,49659232,49203954,48752849,48305880,47863009,47424199,46989411,46558609,46131757,45708819,45289758,44874539,44463127,44055486,43651583,43251383,42854852,42461956,42072663,41686938,41304750,40926066,40550854,40179081,39810717,39445730,39084090,38725764,38370725,38018940,37670380,37325016,36982818,36643757,36307805,35974934,35645113,35318317,34994517,34673685,34355795,34040819,33728731,33419504,33113112,32809529,32508730,32210688,31915379,31622777,31332857,31045596,30760968,30478950,30199517,29922646,29648314,29376497,29107171,28840315,28575905,28313920,28054336,27797133,27542287,27289778,27039584,26791683,26546056,26302680,26061535,25822602,25585859,25351286,25118864,24888573,24660393,24434306,24210290,23988329,23768403,23550493,23334581,23120648,22908677,22698649,22490546,22284351,22080047,21877616,21677041,21478305,21281390,21086281,20892961,20701413,20511622,20323570,20137242,19952623,19769696,19588447,19408859,19230917,19054607,18879913,18706821,18535316,18365383,18197009,18030177,17864876,17701090,17538805,17378008,17218686,17060824,16904409,16749429,16595869,16443717,16292960,16143586,15995580,15848932,15703628,15559656,15417005,15275661,15135612,14996848,14859356,14723125,14588143,14454398,14321879,14190575,14060475,13931568,13803843,13677288,13551894,13427650,13304544,13182567,13061709,12941958,12823306,12705741,12589254,12473835,12359474,12246162,12133889,12022644,11912420,11803206,11694994,11587774,11481536,11376273,11271975,11168632,11066238,10964782,10864256,10764652,10665961,10568175,10471285,10375284,10280163,10185914,10092529,10000000,9908319,9817479,9727472,9638290,9549926,9462372,9375620,9289664,9204496,9120108,9036495,8953648,8871560,8790225,8709636,8629785,8550667,8472274,8394600,8317638,8241381,8165824,8090959,8016781,7943282,7870458,7798301,7726806,7655966,7585776,7516229,7447320,7379042,7311391,7244360,7177943,7112135,7046931,6982324,6918310,6854882,6792036,6729767,6668068,6606934,6546362,6486344,6426877,6367955,6309573,6251727,6194411,6137620,6081350,6025596,5970353,5915616,5861382,5807644,5754399,5701643,5649370,5597576,5546257,5495409,5445027,5395106,5345644,5296634,5248075,5199960,5152286,5105050,5058247,5011872,4965923,4920395,4875285,4830588,4786301,4742420,4698941,4655861,4613176,4570882,4528976,4487454,4446313,4405549,4365158,4325138,4285485,4246196,4207266,4168694,4130475,4092607,4055085,4017908,3981072,3944573,3908409,3872576,3837072,3801894,3767038,3732502,3698282,3664376,3630781,3597493,3564511,3531832,3499452,3467369,3435579,3404082,3372873,3341950,3311311,3280953,3250873,3221069,3191538,3162278,3133286,3104560,3076097,3047895,3019952,2992265,2964831,2937650,2910717,2884032,2857591,2831392,2805434,2779713,2754229,2728978,2703958,2679168,2654606,2630268,2606154,2582260,2558586,2535129,2511886,2488857,2466039,2443431,2421029,2398833,2376840,2355049,2333458,2312065,2290868,2269865,2249055,2228435,2208005,2187762,2167704,2147830,2128139,2108628,2089296,2070141,2051162,2032357,2013724,1995262,1976970,1958845,1940886,1923092,1905461,1887991,1870682,1853532,1836538,1819701,1803018,1786488,1770109,1753881,1737801,1721869,1706082,1690441,1674943,1659587,1644372,1629296,1614359,1599558,1584893,1570363,1555966,1541700,1527566,1513561,1499685,1485936,1472313,1458814,1445440,1432188,1419058,1406048,1393157,1380384,1367729,1355189,1342765,1330454,1318257,1306171,1294196,1282331,1270574,1258925,1247384,1235947,1224616,1213389,1202264,1191242,1180321,1169499,1158777,1148154,1137627,1127197,1116863,1106624,1096478,1086426,1076465,1066596,1056818,1047129,1037528,1028016,1018591,1009253,1000000,990832,981748,972747,963829,954993,946237,937562,928966,920450,912011,903649,895365,887156,879023,870964,862979,855067,847227,839460,831764,824138,816582,809096,801678,794328,787046,779830,772681,765597,758578,751623,744732,737904,731139,724436,717794,711214,704693,698232,691831,685488,679204,672977,666807,660693,654636,648634,642688,636796,630957,625173,619441,613762,608135,602560,597035,591562,586138,580764,575440,570164,564937,559758,554626,549541,544503,539511,534564,529663,524807,519996,515229,510505,505825,501187,496592,492040,487528,483059,478630,474242,469894,465586,461318,457088,452898,448745,444631,440555,436516,432514,428549,424620,420727,416869,413048,409261,405509,401791,398107,394457,390841,387258,383707,380189,376704,373250,369828,366438,363078,359749,356451,353183,349945,346737,343558,340408,337287,334195,331131,328095,325087,322107,319154,316228,313329,310456,307610,304789,301995,299226,296483,293765,291072,288403,285759,283139,280543,277971,275423,272898,270396,267917,265461,263027,260615,258226,255859,253513,251189,248886,246604,244343,242103,239883,237684,235505,233346,231206,229087,226986,224905,222844,220800,218776,216770,214783,212814,210863,208930,207014,205116,203236,201372,199526,197697,195884,194089,192309,190546,188799,187068,185353,183654,181970,180302,178649,177011,175388,173780,172187,170608,169044,167494,165959,164437,162930,161436,159956,158489,157036,155597,154170,152757,151356,149968,148594,147231,145881,144544,143219,141906,140605,139316,138038,136773,135519,134276,133045,131826,130617,129420,128233,127057,125893,124738,123595,122462,121339,120226,119124,118032,116950,115878,114815,113763,112720,111686,110662,109648,108643,107647,106660,105682,104713,103753,102802,101859,100925,100000,99083,98175,97275,96383,95499,94624,93756,92897,92045,91201,90365,89536,88716,87902,87096,86298,85507,84723,83946,83176,82414,81658,80910,80168,79433,78705,77983,77268,76560,75858,75162,74473,73790,73114,72444,71779,71121,70469,69823,69183,68549,67920,67298,66681,66069,65464,64863,64269,63680,63096,62517,61944,61376,60814,60256,59704,59156,58614,58076,57544,57016,56494,55976,55463,54954,54450,53951,53456,52966,52481,52000,51523,51050,50582,50119,49659,49204,48753,48306,47863,47424,46989,46559,46132,45709,45290,44875,44463,44055,43652,43251,42855,42462,42073,41687,41305,40926,40551,40179,39811,39446,39084,38726,38371,38019,37670,37325,36983,36644,36308,35975,35645,35318,34995,34674,34356,34041,33729,33420,33113,32810,32509,32211,31915,31623,31333,31046,30761,30479,30200,29923,29648,29376,29107,28840,28576,28314,28054,27797,27542,27290,27040,26792,26546,26303,26062,25823,25586,25351,25119,24889,24660,24434,24210,23988,23768,23550,23335,23121,22909,22699,22491,22284,22080,21878,21677,21478,21281,21086,20893,20701,20512,20324,20137,19953,19770,19588,19409,19231,19055,18880,18707,18535,18365,18197,18030,17865,17701,17539,17378,17219,17061,16904,16749,16596,16444,16293,16144,15996,15849,15704,15560,15417,15276,15136,14997,14859,14723,14588,14454,14322,14191,14060,13932,13804,13677,13552,13428,13305,13183,13062,12942,12823,12706,12589,12474,12359,12246,12134,12023,11912,11803,11695,11588,11482,11376,11272,11169,11066,10965,10864,10765,10666,10568,10471,10375,10280,10186,10093,10000,9908,9817,9727,9638,9550,9462,9376,9290,9204,9120,9036,8954,8872,8790,8710,8630,8551,8472,8395,8318,8241,8166,8091,8017,7943,7870,7798,7727,7656,7586,7516,7447,7379,7311,7244,7178,7112,7047,6982,6918,6855,6792,6730,6668,6607,6546,6486,6427,6368,6310,6252,6194,6138,6081,6026,5970,5916,5861,5808,5754,5702,5649,5598,5546,5495,5445,5395,5346,5297,5248,5200,5152,5105,5058,5012,4966,4920,4875,4831,4786,4742,4699,4656,4613,4571,4529,4487,4446,4406,4365,4325,4285,4246,4207,4169,4130,4093,4055,4018,3981,3945,3908,3873,3837,3802,3767,3733,3698,3664,3631,3597,3565,3532,3499,3467,3436,3404,3373,3342,3311,3281,3251,3221,3192,3162,3133,3105,3076,3048,3020,2992,2965,2938,2911,2884,2858,2831,2805,2780,2754,2729,2704,2679,2655,2630,2606,2582,2559,2535,2512,2489,2466,2443,2421,2399,2377,2355,2333,2312,2291,2270,2249,2228,2208,2188,2168,2148,2128,2109,2089,2070,2051,2032,2014,1995,1977,1959,1941,1923,1905,1888,1871,1854,1837,1820,1803,1786,1770,1754,1738,1722,1706,1690,1675,1660,1644,1629,1614,1600,1585,1570,1556,1542,1528,1514,1500,1486,1472,1459,1445,1432,1419,1406,1393,1380,1368,1355,1343,1330,1318,1306,1294,1282,1271,1259,1247,1236,1225,1213,1202,1191,1180,1169,1159,1148,1138,1127,1117,1107,1096,1086,1076,1067,1057,1047,1038,1028,1019,1009,1000,991,982,973,964,955,946,938,929,920,912,904,895,887,879,871,863,855,847,839,832,824,817,809,802,794,787,780,773,766,759,752,745,738,731,724,718,711,705,698,692,685,679,673,667,661,655,649,643,637,631,625,619,614,608,603,597,592,586,581,575,570,565,560,555,550,545,540,535,530,525,520,515,511,506,501,497,492,488,483,479,474,470,466,461,457,453,449,445,441,437,433,429,425,421,417,413,409,406,402,398,394,391,387,384,380,377,373,370,366,363,360,356,353,350,347,344,340,337,334,331,328,325,322,319,316,313,310,308,305,302,299,296,294,291,288,286,283,281,278,275,273,270,268,265,263,261,258,256,254,251,249,247,244,242,240,238,236,233,231,229,227,225,223,221,219,217,215,213,211,209,207,205,203,201,200,198,196,194,192,191,189,187,185,184,182,180,179,177,175,174,172,171,169,167,166,164,163,161,160,158,157,156,154,153,151,150,149,147,146,145,143,142,141,139,138,137,136,134,133,132,131,129,128,127,126,125,124,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,95,94,93,92,91,90,90,89,88,87,86,86,85,84,83,82,82,81,80,79,79,78,77,77,76,75,74,74,73,72,72,71,70,70,69,69,68,67,67,66,65,65,64,64,63,63,62,61,61,60,60,59,59,58,58,57,56,56,55,55,54,54,53,53,52,52,52,51,51,50,50,49,49,48,48,47,47,47,46,46,45,45,44,44,44,43,43,42,42,42,41,41,41,40,40,39,39,39,38,38,38,37,37,37,36,36,36,35,35,35,34,34,34,33,33,33,33,32,32,32,31,31,31,30,30,30,30,29,29,29,29,28,28,28,28,27,27,27,27,26,26,26,26,25,25,25,25,24,24,24,24,24,23,23,23,23,22,22,22,22,22,21,21,21,21,21,21,20,20,20,20,20,19,19,19,19,19,19,18,18,18,18,18,18,17,17,17,17,17,17,16,16,16,16,16,16,16,15,15,15,15,15,15,15,14,14,14,14,14,14,14,14,13,13,13,13,13,13,13,13,12,12,12,12,12,12,12,12,12,11,11,11,11,11,11,11,11,11,11,10,10,10,10,10,10,10,10,10,10,10,9,9,9,9,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0};
const unsigned long POT_2100[] = {207014135,205116218,203235701,201372425,199526231,197696964,195884467,194088588,192309173,190546072,188799135,187068214,185353162,183653834,181970086,180301774,178648757,177010896,175388050,173780083,172186857,170608239,169044093,167494288,165958691,164437172,162929603,161435856,159955803,158489319,157036280,155596563,154170045,152756606,151356125,149968484,148593564,147231250,145881426,144543977,143218790,141905752,140604752,139315680,138038426,136772883,135518941,134276496,133045442,131825674,130617089,129419584,128233058,127057411,125892541,124738351,123594743,122461620,121338885,120226443,119124201,118032064,116949939,115877736,114815362,113762729,112719746,111686325,110662378,109647820,108642562,107646521,106659612,105681751,104712855,103752842,102801630,101859139,100925289,100000000,99083194,98174794,97274722,96382902,95499259,94623716,93756201,92896639,92044957,91201084,90364947,89536477,88715601,87902252,87096359,86297855,85506671,84722741,83945999,83176377,82413812,81658237,80909590,80167806,79432823,78704579,77983011,77268059,76559661,75857758,75162289,74473197,73790423,73113908,72443596,71779429,71121351,70469307,69823240,69183097,68548823,67920363,67297666,66680677,66069345,65463617,64863443,64268772,63679552,63095734,62517269,61944108,61376201,60813500,60255959,59703529,59156163,58613816,58076442,57543994,57016427,56493697,55975760,55462571,54954087,54450265,53951062,53456436,52966344,52480746,51999600,51522864,51050500,50582466,50118723,49659232,49203954,48752849,48305880,47863009,47424199,46989411,46558609,46131757,45708819,45289758,44874539,44463127,44055486,43651583,43251383,42854852,42461956,42072663,41686938,41304750,40926066,40550854,40179081,39810717,39445730,39084090,38725764,38370725,38018940,37670380,37325016,36982818,36643757,36307805,35974934,35645113,35318317,34994517,34673685,34355795,34040819,33728731,33419504,33113112,32809529,32508730,32210688,31915379,31622777,31332857,31045596,30760968,30478950,30199517,29922646,29648314,29376497,29107171,28840315,28575905,28313920,28054336,27797133,27542287,27289778,27039584,26791683,26546056,26302680,26061535,25822602,25585859,25351286,25118864,24888573,24660393,24434306,24210290,23988329,23768403,23550493,23334581,23120648,22908677,22698649,22490546,22284351,22080047,21877616,21677041,21478305,21281390,21086281,20892961,20701413,20511622,20323570,20137242,19952623,19769696,19588447,19408859,19230917,19054607,18879913,18706821,18535316,18365383,18197009,18030177,17864876,17701090,17538805,17378008,17218686,17060824,16904409,16749429,16595869,16443717,16292960,16143586,15995580,15848932,15703628,15559656,15417005,15275661,15135612,14996848,14859356,14723125,14588143,14454398,14321879,14190575,14060475,13931568,13803843,13677288,13551894,13427650,13304544,13182567,13061709,12941958,12823306,12705741,12589254,12473835,12359474,12246162,12133889,12022644,11912420,11803206,11694994,11587774,11481536,11376273,11271975,11168632,11066238,10964782,10864256,10764652,10665961,10568175,10471285,10375284,10280163,10185914,10092529,10000000,9908319,9817479,9727472,9638290,9549926,9462372,9375620,9289664,9204496,9120108,9036495,8953648,8871560,8790225,8709636,8629785,8550667,8472274,8394600,8317638,8241381,8165824,8090959,8016781,7943282,7870458,7798301,7726806,7655966,7585776,7516229,7447320,7379042,7311391,7244360,7177943,7112135,7046931,6982324,6918310,6854882,6792036,6729767,6668068,6606934,6546362,6486344,6426877,6367955,6309573,6251727,6194411,6137620,6081350,6025596,5970353,5915616,5861382,5807644,5754399,5701643,5649370,5597576,5546257,5495409,5445027,5395106,5345644,5296634,5248075,5199960,5152286,5105050,5058247,5011872,4965923,4920395,4875285,4830588,4786301,4742420,4698941,4655861,4613176,4570882,4528976,4487454,4446313,4405549,4365158,4325138,4285485,4246196,4207266,4168694,4130475,4092607,4055085,4017908,3981072,3944573,3908409,3872576,3837072,3801894,3767038,3732502,3698282,3664376,3630781,3597493,3564511,3531832,3499452,3467369,3435579,3404082,3372873,3341950,3311311,3280953,3250873,3221069,3191538,3162278,3133286,3104560,3076097,3047895,3019952,2992265,2964831,2937650,2910717,2884032,2857591,2831392,2805434,2779713,2754229,2728978,2703958,2679168,2654606,2630268,2606154,2582260,2558586,2535129,2511886,2488857,2466039,2443431,2421029,2398833,2376840,2355049,2333458,2312065,2290868,2269865,2249055,2228435,2208005,2187762,2167704,2147830,2128139,2108628,2089296,2070141,2051162,2032357,2013724,1995262,1976970,1958845,1940886,1923092,1905461,1887991,1870682,1853532,1836538,1819701,1803018,1786488,1770109,1753881,1737801,1721869,1706082,1690441,1674943,1659587,1644372,1629296,1614359,1599558,1584893,1570363,1555966,1541700,1527566,1513561,1499685,1485936,1472313,1458814,1445440,1432188,1419058,1406048,1393157,1380384,1367729,1355189,1342765,1330454,1318257,1306171,1294196,1282331,1270574,1258925,1247384,1235947,1224616,1213389,1202264,1191242,1180321,1169499,1158777,1148154,1137627,1127197,1116863,1106624,1096478,1086426,1076465,1066596,1056818,1047129,1037528,1028016,1018591,1009253,1000000,990832,981748,972747,963829,954993,946237,937562,928966,920450,912011,903649,895365,887156,879023,870964,862979,855067,847227,839460,831764,824138,816582,809096,801678,794328,787046,779830,772681,765597,758578,751623,744732,737904,731139,724436,717794,711214,704693,698232,691831,685488,679204,672977,666807,660693,654636,648634,642688,636796,630957,625173,619441,613762,608135,602560,597035,591562,586138,580764,575440,570164,564937,559758,554626,549541,544503,539511,534564,529663,524807,519996,515229,510505,505825,501187,496592,492040,487528,483059,478630,474242,469894,465586,461318,457088,452898,448745,444631,440555,436516,432514,428549,424620,420727,416869,413048,409261,405509,401791,398107,394457,390841,387258,383707,380189,376704,373250,369828,366438,363078,359749,356451,353183,349945,346737,343558,340408,337287,334195,331131,328095,325087,322107,319154,316228,313329,310456,307610,304789,301995,299226,296483,293765,291072,288403,285759,283139,280543,277971,275423,272898,270396,267917,265461,263027,260615,258226,255859,253513,251189,248886,246604,244343,242103,239883,237684,235505,233346,231206,229087,226986,224905,222844,220800,218776,216770,214783,212814,210863,208930,207014,205116,203236,201372,199526,197697,195884,194089,192309,190546,188799,187068,185353,183654,181970,180302,178649,177011,175388,173780,172187,170608,169044,167494,165959,164437,162930,161436,159956,158489,157036,155597,154170,152757,151356,149968,148594,147231,145881,144544,143219,141906,140605,139316,138038,136773,135519,134276,133045,131826,130617,129420,128233,127057,125893,124738,123595,122462,121339,120226,119124,118032,116950,115878,114815,113763,112720,111686,110662,109648,108643,107647,106660,105682,104713,103753,102802,101859,100925,100000,99083,98175,97275,96383,95499,94624,93756,92897,92045,91201,90365,89536,88716,87902,87096,86298,85507,84723,83946,83176,82414,81658,80910,80168,79433,78705,77983,77268,76560,75858,75162,74473,73790,73114,72444,71779,71121,70469,69823,69183,68549,67920,67298,66681,66069,65464,64863,64269,63680,63096,62517,61944,61376,60814,60256,59704,59156,58614,58076,57544,57016,56494,55976,55463,54954,54450,53951,53456,52966,52481,52000,51523,51050,50582,50119,49659,49204,48753,48306,47863,47424,46989,46559,46132,45709,45290,44875,44463,44055,43652,43251,42855,42462,42073,41687,41305,40926,40551,40179,39811,39446,39084,38726,38371,38019,37670,37325,36983,36644,36308,35975,35645,35318,34995,34674,34356,34041,33729,33420,33113,32810,32509,32211,31915,31623,31333,31046,30761,30479,30200,29923,29648,29376,29107,28840,28576,28314,28054,27797,27542,27290,27040,26792,26546,26303,26062,25823,25586,25351,25119,24889,24660,24434,24210,23988,23768,23550,23335,23121,22909,22699,22491,22284,22080,21878,21677,21478,21281,21086,20893,20701,20512,20324,20137,19953,19770,19588,19409,19231,19055,18880,18707,18535,18365,18197,18030,17865,17701,17539,17378,17219,17061,16904,16749,16596,16444,16293,16144,15996,15849,15704,15560,15417,15276,15136,14997,14859,14723,14588,14454,14322,14191,14060,13932,13804,13677,13552,13428,13305,13183,13062,12942,12823,12706,12589,12474,12359,12246,12134,12023,11912,11803,11695,11588,11482,11376,11272,11169,11066,10965,10864,10765,10666,10568,10471,10375,10280,10186,10093,10000,9908,9817,9727,9638,9550,9462,9376,9290,9204,9120,9036,8954,8872,8790,8710,8630,8551,8472,8395,8318,8241,8166,8091,8017,7943,7870,7798,7727,7656,7586,7516,7447,7379,7311,7244,7178,7112,7047,6982,6918,6855,6792,6730,6668,6607,6546,6486,6427,6368,6310,6252,6194,6138,6081,6026,5970,5916,5861,5808,5754,5702,5649,5598,5546,5495,5445,5395,5346,5297,5248,5200,5152,5105,5058,5012,4966,4920,4875,4831,4786,4742,4699,4656,4613,4571,4529,4487,4446,4406,4365,4325,4285,4246,4207,4169,4130,4093,4055,4018,3981,3945,3908,3873,3837,3802,3767,3733,3698,3664,3631,3597,3565,3532,3499,3467,3436,3404,3373,3342,3311,3281,3251,3221,3192,3162,3133,3105,3076,3048,3020,2992,2965,2938,2911,2884,2858,2831,2805,2780,2754,2729,2704,2679,2655,2630,2606,2582,2559,2535,2512,2489,2466,2443,2421,2399,2377,2355,2333,2312,2291,2270,2249,2228,2208,2188,2168,2148,2128,2109,2089,2070,2051,2032,2014,1995,1977,1959,1941,1923,1905,1888,1871,1854,1837,1820,1803,1786,1770,1754,1738,1722,1706,1690,1675,1660,1644,1629,1614,1600,1585,1570,1556,1542,1528,1514,1500,1486,1472,1459,1445,1432,1419,1406,1393,1380,1368,1355,1343,1330,1318,1306,1294,1282,1271,1259,1247,1236,1225,1213,1202,1191,1180,1169,1159,1148,1138,1127,1117,1107,1096,1086,1076,1067,1057,1047,1038,1028,1019,1009,1000,991,982,973,964,955,946,938,929,920,912,904,895,887,879,871,863,855,847,839,832,824,817,809,802,794,787,780,773,766,759,752,745,738,731,724,718,711,705,698,692,685,679,673,667,661,655,649,643,637,631,625,619,614,608,603,597,592,586,581,575,570,565,560,555,550,545,540,535,530,525,520,515,511,506,501,497,492,488,483,479,474,470,466,461,457,453,449,445,441,437,433,429,425,421,417,413,409,406,402,398,394,391,387,384,380,377,373,370,366,363,360,356,353,350,347,344,340,337,334,331,328,325,322,319,316,313,310,308,305,302,299,296,294,291,288,286,283,281,278,275,273,270,268,265,263,261,258,256,254,251,249,247,244,242,240,238,236,233,231,229,227,225,223,221,219,217,215,213,211,209,207,205,203,201,200,198,196,194,192,191,189,187,185,184,182,180,179,177,175,174,172,171,169,167,166,164,163,161,160,158,157,156,154,153,151,150,149,147,146,145,143,142,141,139,138,137,136,134,133,132,131,129,128,127,126,125,124,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,95,94,93,92,91,90,90,89,88,87,86,86,85,84,83,82,82,81,80,79,79,78,77,77,76,75,74,74,73,72,72,71,70,70,69,69,68,67,67,66,65,65,64,64,63,63,62,61,61,60,60,59,59,58,58,57,56,56,55,55,54,54,53,53,52,52,52,51,51,50,50,49,49,48,48,47,47,47,46,46,45,45,44,44,44,43,43,42,42,42,41,41,41,40,40,39,39,39,38,38,38,37,37,37,36,36,36,35,35,35,34,34,34,33,33,33,33,32,32,32,31,31,31,30,30,30,30,29,29,29,29,28,28,28,28,27,27,27,27,26,26,26,26,25,25,25,25,24,24,24,24,24,23,23,23,23,22,22,22,22,22,21,21,21,21,21,21,20,20,20,20,20,19,19,19,19,19,19,18,18,18,18,18,18,17,17,17,17,17,17,16,16,16,16,16,16,16,15,15,15,15,15,15,15,14,14,14,14,14,14,14,14,13,13,13,13,13,13,13,13,12,12,12,12,12,12,12,12,12,11,11,11,11,11,11,11,11,11,11,10,10,10,10,10,10,10,10,10,10,10,9,9,9,9,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0};

//todo: Number of samples taken
int SamplesTaken = 0;	//bN

//todo: Variables temporales para cálculos
signed short slValue;

//todo: PREGUNTAR: ESTOS PARA QUE SIRVEN??
//char arranque = 0/*1*/, primeralectura = 0, primeracalibracionHALL = 0, primeracalibracionPOT=0;

//#pragma location=0x249F0	//Guardo array en FLASH direccion 0x249F0
extern union register_entry ArrayTControl[TC_NUM_REGS];				//Nico: Cada slot de estos [] ocupa 2bytes
//extern union register_entry ArrayGen[GEN_NUM_REGS];

signed short DEBUG_Pot_Fwd_BF;
signed short DEBUG_PotPre_Fwd_BF;
signed short DEBUG_PotPre_Fwd_AF;
signed short DEBUG_Pot_Rvs_BF;
signed short DEBUG_RL_BF;
signed short DEBUG_Temp_C_BF;
signed short DEBUG_Pot_Rvs_AF;
signed short DEBUG_Pot_Fwd_AF;
signed short DEBUG_RL_AF;

//extern parameters param[2];		//MOVE: Mover a main.c ó HAL.h
//extern char CambioPerfilON, /*StandBy,*/ ONreciente;
//extern unsigned char soyBF;
//-->CTL_EVENT_SET_t AdcAllSampled;		//PREGUNTAR!: Que gestión de eventos usar??
//extern char ADD_DEVICE;

//---------------------------------------- HWI and Events -----------------------------------------------
//Task_Params taskParams;
//Task_Handle task0;
//extern Event_Handle Event_ADC;
//Event_Handle Event_ADC;

//---------------------------------------- FUNCTION METHODS ----------------------------------------
//ADC set-up
void ADC12_Config(void)
{
	// Select port 6.[0,1,2,3,4,5,6,7] as ADC Peripheral module function
	P6SEL |= (BIT0 + BIT1 + BIT2 + BIT3 + BIT4 + BIT5 + BIT6 + BIT7);

	//Configure ADC12 control registers
	ADC12CTL0 |= ADC12SHT1_4 + ADC12SHT0_4 + ADC12MSC + ADC12ON;  		// SnH MEM8-MEM15 64 cyles, SnH MEM0-MEM7 64 cycles, multiple sample and conversion, ADC12 ON
    ADC12CTL1 |= ADC12SHP + ADC12DIV_7 + ADC12SSEL_2 + ADC12CONSEQ_3;	// SnH pulse mode, Clk divider 8, clk source MCLK, conversion Repeat-sequence-of-channels

    ADC12CTL2 |= ADC12RES_2 + ADC12TCOFF;								//12-bit resolution

    //Assign Conversion Memory Control and Input channels
    ADC12MCTL0 = ADC12INCH_0;											//Input Channel A0 = Power Previo 1 LF
    ADC12MCTL1 = ADC12INCH_1;											//Input Channel A1 = Power Previo 2 HF
    ADC12MCTL2 = ADC12INCH_2;											//Input Channel A2 = Incident Power HPA1 LF
    ADC12MCTL3 = ADC12INCH_3;											//Input Channel A3 = Incident Power HPA2 HF
    ADC12MCTL4 = ADC12INCH_4;											//Input Channel A4 = Reflected Power HPA1 LF
    ADC12MCTL5 = ADC12INCH_5;											//Input Channel A5 = Reflected Power HPA2 HF
    ADC12MCTL6 = ADC12INCH_6 /*+ ADC12EOS*/;							//Input Channel A6 = Temperature HPA1 LF 				Preguntar: porque EOS aquí ??
    ADC12MCTL7 = ADC12INCH_7 + ADC12EOS;								//Input Channel A7 = Temperature HPA2 HF

    //Enables the interrupt request for the ADC12IFG7 bit
    ADC12IE |= BIT7; 							//Preguntar: porque sólo bit 7 ?

    /////////////////////////////////////
    REFCTL0 &= ~REFMSTR;								//Desabilitar el módulo REF
    ADC12CTL0 |= ADC12REF2_5V + ADC12REFON;				//Referencia 2.5V

    ADC12MCTL0 |= ADC12SREF_1;
    ADC12MCTL1 |= ADC12SREF_1;
    ADC12MCTL2 |= ADC12SREF_1;
    ADC12MCTL3 |= ADC12SREF_1;
    ADC12MCTL4 |= ADC12SREF_1;
    ADC12MCTL5 |= ADC12SREF_1;
    ADC12MCTL6 |= ADC12SREF_1;
    ADC12MCTL7 |= ADC12SREF_1;
    ////////////////////////////////////

    // Start Conversion
    ADC12CTL0 |= ADC12ENC + ADC12SC;									//ADC12 Enable, Start Conversion
}


void ADC12_RTOS_Init(void)
{
//	//------------------- HW INTERRUPT CREATION ----------------------------
//	Hwi_Handle hwi0;
//	Hwi_Params hwiParams;
//	Error_Block eb;
//	Error_init(&eb);
//	int id_ADCInt = 54;		//ID of the ADC12 Interrupt (pag.19 del manual del micro MSP430F5636)
//	Hwi_Params_init(&hwiParams);
//	//hwiParams.arg = 0;
//	hwi0 = Hwi_create(id_ADCInt, ADC12_ISR, NULL/*&hwiParams*/, NULL/*&eb*/);
//	if (hwi0 == NULL)
//		System_abort("ADC12 Hwi create failed");
//
//	//------------------- EVENT ADC SAMPLE ----------------------------
//	if ( !(Event_ADC = Event_create(NULL, &eb)) )
//		System_abort("Event Event_ADC create failed");


	Event_post(Event_ADC, NO_ALLSAMPLED);
}


unsigned short ADC12_Convert_V2T (unsigned short Temp_mV)
{
	signed short Temp1_C = 0;
	signed short Temp2_C = 0;
	//signed short Temp3_C = 0;

	//Formula taken from HPA BF
	Temp1_C = ((signed short)Temp_mV - 750) / 10;
	Temp2_C = 25/*ºC*/ + Temp1_C;

	//---- Taken out for Sparta ----
	//if (Temp2_C <= 25)	//Min measurable value returned by the HPAs
	//	Temp2_C = 25;
	//-----------------------------

	return Temp2_C; //ºC
}


//ADC Interrupt Service Rutine
//#pragma vector=ADC12_VECTOR				//Los vectores de interrupción se pueden consultar en pag.19 del manual del micro MSP430F5636
//__interrupt void ADC12_ISR (void)
void ADC12_ISR(UArg arg0)
{
	//AUX_2_POUT |= AUX_2_MASK; 	//Toogle pin 9.6 in Platinum card
	LED_1_POUT |= LED_1_MASK;		//Pin 9.2 (Sparta & Platinum)
	//AUX_4_POUT |= AUX_4_MASK; 		//Toogle pin 9.7 (Sparta)

	//Incident Power HPA1 LF (20Mhz - 500Mhz) - J1
	Power_FWD_LF = ADC12MEM2;
	//Power_FWD_LF *= AD_VREF_PLUS_STEP_mV;
	//Power_FWD_LF = Power_FWD_LF>>12;		//PREGUNTAR: Divide entre 4096 aquí y luego vuelve a hacerlo abajo en todos otra vez ?? --> POR LA CONVERSIÓN DEL ADC12, TE DA EL RESULTADO EN MUESTRAS, PASAR A mV !!
	//if(Power_FWD_LF > 2700)
		//Power_FWD_LF = 2700;

	//Reflected Power HPA1 LF - J2
	Power_RVS_LF = ADC12MEM4;
	//Power_RVS_LF *= AD_VREF_PLUS_STEP_mV;
	//Power_RVS_LF = Power_RVS_LF>>12;
	//if(Power_RVS_LF > 2700)
		//Power_RVS_LF = 2700;

	//Incident Power HPA2 HF (0.5Ghz - 2.7Ghz) - J3
	Power_FWD_HF = ADC12MEM3;
	//Power_FWD_HF *= AD_VREF_PLUS_STEP_mV;
	//Power_FWD_HF = Power_FWD_HF>>12;
	//if(Power_FWD_HF > 2700)
		//Power_FWD_HF = 2700;

	//Reflected Power HPA2 HF - J4
	Power_RVS_HF = ADC12MEM5;
	//Power_RVS_HF *= AD_VREF_PLUS_STEP_mV;
	//Power_RVS_HF = Power_RVS_HF>>12;
	//if(Power_RVS_HF > 2700)
		//Power_RVS_HF = 2700;

	//Power Previo 1 LF - J5
	PrePower_FWD_LF = ADC12MEM0;
	//PrePower_FWD_LF *= AD_VREF_PLUS_STEP_mV;
	//PrePower_FWD_LF = PrePower_FWD_LF>>12;
	//if(PrePower_FWD_LF > 2700)
		//PrePower_FWD_LF = 2700;

	//Power Previo 2 HF - J6
	PrePower_FWD_HF = ADC12MEM1;
	//PrePower_FWD_HF *= AD_VREF_PLUS_STEP_mV;
	//PrePower_FWD_HF = PrePower_FWD_HF>>12;
	//if(PrePower_FWD_HF > 2700)
		//PrePower_FWD_HF = 2700;

	//Sum values
	PowerSum_FWD_LF += Power_FWD_LF;
	PowerSum_RVS_LF += Power_RVS_LF;
	PowerSum_FWD_HF += Power_FWD_HF;
	PowerSum_RVS_HF += Power_RVS_HF;
	PrePowerSum_FWD_LF += PrePower_FWD_LF;
	PrePowerSum_FWD_HF += PrePower_FWD_HF;

	//Keep summing up all the temperature sampled values for the average
	TempeSum_LF += ADC12MEM6;
	TempeSum_HF += ADC12MEM7;

	//Increase Sample taken
	SamplesTaken++;	//ex bN

	//If AD_SAMPLES_PRUEBA is reached
	if(SamplesTaken >= AD_SAMPLES_PRUEBA)
	{
		//AUX_2_POUT |= AUX_2_MASK; //Toogle pin 9.7

		//Reset samples taken counter
		SamplesTaken = 0;

		//--------------------------------------------------------------
		//Dividir por 2^7 muestras y 2^12 de los 12bits del ADC12. Multiplicar por 2500mV del ADC12
		PowerAvg_FWD_LF = PowerSum_FWD_LF >> AD_SAMPLE2mV_EXP1;
		PowerAvg_FWD_LF *= AD_VREF_PLUS_STEP_mV;
		PowerAvg_FWD_LF = PowerAvg_FWD_LF >> AD_SAMPLE2mV_EXP2_SAMPLES_PRUEBA_EXP;

		PowerAvg_RVS_LF = PowerSum_RVS_LF >> AD_SAMPLE2mV_EXP1;
		PowerAvg_RVS_LF *= AD_VREF_PLUS_STEP_mV;
		PowerAvg_RVS_LF = PowerAvg_RVS_LF >> AD_SAMPLE2mV_EXP2_SAMPLES_PRUEBA_EXP;

		PowerAvg_FWD_HF = PowerSum_FWD_HF >> AD_SAMPLE2mV_EXP1;
		PowerAvg_FWD_HF *= AD_VREF_PLUS_STEP_mV;
		PowerAvg_FWD_HF = PowerAvg_FWD_HF >> AD_SAMPLE2mV_EXP2_SAMPLES_PRUEBA_EXP;

		PowerAvg_RVS_HF = PowerSum_RVS_HF >> AD_SAMPLE2mV_EXP1;
		PowerAvg_RVS_HF *= AD_VREF_PLUS_STEP_mV;
		PowerAvg_RVS_HF = PowerAvg_RVS_HF >> AD_SAMPLE2mV_EXP2_SAMPLES_PRUEBA_EXP;

		PrePowerAvg_FWD_LF = PrePowerSum_FWD_LF >> AD_SAMPLE2mV_EXP1;
		PrePowerAvg_FWD_LF *= AD_VREF_PLUS_STEP_mV;
		PrePowerAvg_FWD_LF = PrePowerAvg_FWD_LF >> AD_SAMPLE2mV_EXP2_SAMPLES_PRUEBA_EXP;

		PrePowerAvg_FWD_HF = PrePowerSum_FWD_HF >> AD_SAMPLE2mV_EXP1;
		PrePowerAvg_FWD_HF *= AD_VREF_PLUS_STEP_mV;
		PrePowerAvg_FWD_HF = PrePowerAvg_FWD_HF >> AD_SAMPLE2mV_EXP2_SAMPLES_PRUEBA_EXP;

		TempeAvg_LF = TempeSum_LF >> AD_SAMPLE2mV_EXP1;
		TempeAvg_LF *= AD_VREF_PLUS_STEP_mV;
		TempeAvg_LF = TempeAvg_LF >> AD_SAMPLE2mV_EXP2_SAMPLES_PRUEBA_EXP;

		TempeAvg_HF = TempeSum_HF >> AD_SAMPLE2mV_EXP1;
		TempeAvg_HF *= AD_VREF_PLUS_STEP_mV;
		TempeAvg_HF = TempeAvg_HF >> AD_SAMPLE2mV_EXP2_SAMPLES_PRUEBA_EXP;
		//--------------------------------------------------------------

		//--------------------------------------------------------------
//		//Get AVG power values: divide the Power summed values by AD_SAMPLES_PRUEBA or move 12 bits right (todo: parametrizar ese 12)
//		PowerAvg_FWD_LF = PowerSum_FWD_LF >> AD_SAMPLES_PRUEBA_EXP;	//(preguntar: sustituir por potenciaSumRVS900 /AD_SAMPLES_PRUEBA)
//		PowerAvg_RVS_LF = PowerSum_RVS_LF >> AD_SAMPLES_PRUEBA_EXP;
//		PowerAvg_FWD_HF = PowerSum_FWD_HF >> AD_SAMPLES_PRUEBA_EXP;
//		PowerAvg_RVS_HF = PowerSum_RVS_HF >> AD_SAMPLES_PRUEBA_EXP;
//		PrePowerAvg_FWD_LF = PrePowerSum_FWD_LF >> AD_SAMPLES_PRUEBA_EXP;
//		PrePowerAvg_FWD_HF = PrePowerSum_FWD_HF >> AD_SAMPLES_PRUEBA_EXP;
//
//		//Get AVG temperature values: divide the Temperature summed values by AD_SAMPLES_PRUEBA or move 12 bits right (todo: parametrizar ese 12)
//		TempeAvg_LF = TempeSum_LF >> AD_SAMPLES_PRUEBA_EXP;					//(preguntar: sustituir por TempeSum_LF /AD_SAMPLES_PRUEBA)
//		TempeAvg_HF = TempeSum_HF >> AD_SAMPLES_PRUEBA_EXP;
		//--------------------------------------------------------------

		//Incident Power HPA1 LF (20Mhz - 500Mhz) - J1
		if(PowerAvg_FWD_LF != 0)
		{
			//Usando: Recta de ajuste P.Incidente BF SN-140001 250Mhz -> y = 0,0339x - 28,596 | Añadimos offset empírico de 1.5dBm
			//ArrayTControl[REG_POTFWD_BF].s_16 = 10 * ( (0.0339 * PowerAvg_FWD_LF) - 28.596 /*+ 1.5*/);	//In 10*dBm
			ArrayTControl[REG_POTFWD_BF].s_16 = (unsigned long)((2777 * PowerAvg_FWD_LF) >> 13) - 286;
			DEBUG_Pot_Fwd_BF = ArrayTControl[REG_POTFWD_BF].s_16 /*dBm x 10*/;

			if (ArrayTControl[REG_POTFWD_BF].s_16 < 200)	//*DEBUGGING*
				_NOP();										//*DEBUGGING*
		}

		//Reflected Power HPA1 LF - J2
		if(PowerAvg_RVS_LF != 0)
		{
			//Usando: Recta de ajuste P.Incidente BF SN-140001 250Mhz -> y = 0,0339x - 28,596
			//ArrayTControl[REG_POTRVS_BF].s_16 = 10 * ( (0.0339 * PowerAvg_RVS_LF) - 28.596 );	//In 10*dBm
			ArrayTControl[REG_POTRVS_BF].s_16 = (unsigned long)((2777 * PowerAvg_RVS_LF) >> 13) - 286;
			DEBUG_Pot_Rvs_BF = ArrayTControl[REG_POTRVS_BF].s_16 /*dBm x 10*/;
		}

		short RL_LF = (ArrayTControl[REG_POTFWD_BF].s_16 - ArrayTControl[REG_POTRVS_BF].s_16); //(Return Loss * 10) in dB
		DEBUG_RL_BF = RL_LF;
		/*COMMENT LINE FOR DEBUGGING FSM SWR*/ ArrayTControl[REG_SWR_BF].s_16 = RL_LF;


		//Incident Power HPA2 HF (0.5Ghz - 2.7Ghz) - J3
		if(PowerAvg_FWD_HF != 0)
		{
			//Usando: Recta de ajuste P.Incidente AF SN-140001 1500Mhz -> y = 0,0333x - 26,441
			//ArrayTControl[REG_POTFWD_AF].s_16 = 10 * ((0.033 * PowerAvg_FWD_HF) - 26.441);		//In 10*dBm
			ArrayTControl[REG_POTFWD_AF].s_16 = (unsigned long)( ((169 * PowerAvg_FWD_HF) >> 1) - 67689) >> 8;
			DEBUG_Pot_Fwd_AF = ArrayTControl[REG_POTFWD_AF].s_16;
		}

		//Reflected Power HPA2 HF - J4
		if(PowerAvg_RVS_HF != 0)
		{
			//Usando: Recta de ajuste P.Incidente AF SN-140001 1500Mhz -> y = 0,0333x - 26,441
			//ArrayTControl[REG_POTRVS_AF].s_16 = 10 * ((0.033 * PowerAvg_RVS_HF) - 26.441);		//In 10*dBm
			ArrayTControl[REG_POTRVS_AF].s_16 = (unsigned long)( ((169 * PowerAvg_RVS_HF) >> 1) - 67689) >> 8;
			DEBUG_Pot_Rvs_AF = ArrayTControl[REG_POTRVS_AF].s_16;
		}

		//SWR HPA2 HF
		short RL_HF = (ArrayTControl[REG_POTFWD_AF].s_16 - ArrayTControl[REG_POTRVS_AF].s_16); //(Return Loss * 10) in dB
		DEBUG_RL_AF = RL_HF;
		ArrayTControl[REG_SWR_AF].s_16 = RL_HF;



		//Power Previo 1 LF (Previo BF) - J5
		if(PrePowerAvg_FWD_LF != 0)
		{
			//Usando recta de ajuste P.Previo BF SN-140002 100Mhz -> y = 0,0312x - 23,22
			//ArrayTControl[REG_POT1PREVIO_BF].s_16 = 10 * ((0.0312 * PrePowerAvg_FWD_LF) - 23.22);	//In 10*dBm
			ArrayTControl[REG_POT1PREVIO_BF].s_16 = (unsigned long)(((639 * PrePowerAvg_FWD_LF) >> 7) - 3715) >> 4;
			DEBUG_PotPre_Fwd_BF = ArrayTControl[REG_POT1PREVIO_BF].s_16;
		}

		//Power Previo 2 HF (Previo AF)
		if(PrePowerAvg_FWD_HF != 0)
		{
			//Usando recta de ajuste P.Previo AF SN-140001 2250Mhz -> y = 0,0315x - 23,379
			//ArrayTControl[REG_POT1PREVIO_AF].s_16 = 10 * ((0.0315 * PrePowerAvg_FWD_HF) - 23.379);		//In 10*dBm
			ArrayTControl[REG_POT1PREVIO_AF].s_16 = (unsigned long)(((5611 * PrePowerAvg_FWD_HF) >> 4) - 239401) >> 10;
			DEBUG_PotPre_Fwd_AF = ArrayTControl[REG_POT1PREVIO_AF].s_16;
		}

		//HPA BF Temperature Sensor
		unsigned short Temp_C_LF = ADC12_Convert_V2T (TempeAvg_LF/*slValue*/);
		ArrayTControl[REG_T_BF].s_16 = Temp_C_LF;
		DEBUG_Temp_C_BF = ArrayTControl[REG_T_BF].s_16;

		//HPA AF Temperature Sensor
		unsigned short Temp_C_HF = ADC12_Convert_V2T (TempeAvg_HF/*slValue*/);
		ArrayTControl[REG_T_AF].s_16 = Temp_C_HF;


		//Reset Sum and AVG values for Power and Temperature
		PowerSum_FWD_LF = 0;
		PowerSum_RVS_LF = 0;
		PowerSum_FWD_HF = 0;
		PowerSum_RVS_HF = 0;
		PrePowerSum_FWD_LF = 0;
		PrePowerSum_FWD_HF = 0;
		PowerAvg_FWD_LF = 0;
		PowerAvg_RVS_LF = 0;
		PowerAvg_FWD_HF = 0;
		PowerAvg_RVS_HF = 0;
		PrePowerAvg_FWD_LF = 0;
		PrePowerAvg_FWD_HF = 0;
		TempeSum_LF = 0;
		TempeSum_HF = 0;
		TempeAvg_LF = 0;
		TempeAvg_HF = 0;

	//AUX_2_POUT &= ~AUX_2_MASK; //Toogle pin 9.5
	}

	//AUX_2_POUT &= ~AUX_2_MASK; //Toogle pin 9.5
	LED_1_POUT &= ~LED_1_MASK;	//Pin 9.2 (Sparta & Platinum)
	//AUX_4_POUT &= ~AUX_4_MASK; //Toogle pin 9.7 (Sparta)
 }
